<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>êµìœ¡ìš© ë„ë°• ì‹œë®¬ë ˆì´ì…˜ ë£°ë ›</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  .reel {
    width: 96px;
    height: 96px;
    border-radius: 12px;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:34px;
    font-weight:700;
    background: linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.02));
    box-shadow: 0 6px 18px rgba(0,0,0,0.25);
    overflow:hidden;
    position:relative;
  }
  .reel-strip {
    position:absolute;
    top:0;
    left:0;
    right:0;
    display:flex;
    flex-direction:column;
    align-items:center;
    transition:transform 0.1s linear;
  }
  @media (max-width: 640px) {
    .reel { width:72px!important; height:72px!important; font-size:26px!important; }
  }
  .backdrop { background:rgba(0,0,0,0.6); }
</style>
</head>
<body class="bg-gradient-to-b from-slate-900 via-slate-800 to-slate-900 text-white min-h-screen flex items-center justify-center p-4">

<div class="max-w-4xl w-full bg-slate-900/60 border border-slate-700 rounded-2xl p-6 shadow-2xl hidden" id="mainGame">
  <div class="flex items-center justify-between mb-4">
    <div id="nicknameDisplay" class="text-lg font-semibold">ë‹‰ë„¤ì„: <span id="nicknameText">-</span></div>
    <div class="text-right">
      <div class="text-sm text-slate-300">í˜„ì¬ ë³´ìœ  ê¸ˆì•¡</div>
      <div id="balanceDisplay" class="text-2xl font-extrabold">â‚©100,000</div>
    </div>
  </div>

  <div class="bg-slate-800/40 border border-slate-700 p-4 rounded-lg mb-4">
    <div class="font-bold text-lg mb-2">ê·œì¹™</div>
    <ul class="text-sm space-y-1">
      <li>â€¢ ì„¸ ì¹¸ ëª¨ë‘ ê°™ì€ ê²ƒì´ ë‚˜ì˜¤ë©´ ê±°ì‹  ê¸ˆì•¡ì˜ ë‘ ë°°ë¥¼ ë“œë¦½ë‹ˆë‹¤. (ì´ 3ë°°)</li>
      <li>â€¢ ë‘ ì¹¸ ì„±ê³µ ì‹œ ê±°ì‹  ê¸ˆì•¡ì˜ 10%ë¥¼ ë“œë¦½ë‹ˆë‹¤. (ì´ 1.1ë°°)</li>
      <li>â€¢ ëª¨ë‘ ì‹¤íŒ¨ ì‹œ ê±°ì‹  ê¸ˆì•¡ì˜ 50%ë¥¼ ê°€ì ¸ê°‘ë‹ˆë‹¤. (ì´ 0.5ë°°)</li>
      <li class="text-yellow-300">â€» ë§¤ ìŠ¤í•€ë§ˆë‹¤ í˜„ì¬ ë³´ìœ  ê¸ˆì•¡ ì „ì²´ë¥¼ ê±¸ê²Œ ë©ë‹ˆë‹¤.</li>
    </ul>
  </div>

  <div class="flex flex-col md:flex-row items-center justify-between gap-4">
    <div class="flex items-center justify-center gap-3 flex-1">
      <div class="reel"><div class="reel-strip" id="strip1">?</div></div>
      <div class="reel"><div class="reel-strip" id="strip2">?</div></div>
      <div class="reel"><div class="reel-strip" id="strip3">?</div></div>
    </div>

    <div class="w-full md:w-64 bg-slate-800/30 p-4 rounded-lg border border-slate-700">
      <div class="mb-3 text-sm">ìŠ¤í•€ ì¡°ì‘</div>
      <button id="spinBtn" class="w-full py-3 rounded-xl bg-gradient-to-r from-rose-500 to-pink-500 font-bold shadow-lg transform active:scale-95">
        ëŒë¦¬ê¸° (ì†ì¡ì´)
      </button>
      <div class="mt-3 text-xs text-slate-300">í™•ë¥  ê¸°ë°˜ ìŠ¤í•€ì…ë‹ˆë‹¤.</div>
    </div>
  </div>

  <div class="mt-6 bg-slate-800/20 p-3 rounded-lg text-sm text-slate-300 h-32 overflow-auto" id="logBox">
    <div class="text-slate-400">ê²Œì„ ë¡œê·¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>
  </div>
</div>

<div id="nicknameModal" class="fixed inset-0 z-50 flex items-center justify-center backdrop">
  <div class="bg-slate-900 rounded-xl p-6 max-w-md w-full border border-slate-700">
    <h2 class="text-xl font-bold mb-2">ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”</h2>
    <input id="nicknameInput" class="w-full p-3 rounded-lg bg-slate-800 border border-slate-700 focus:outline-none" placeholder="ì˜ˆ: í•´ë“ " />
    <div class="mt-4 flex justify-end">
      <button id="nickConfirm" class="px-4 py-2 rounded-lg bg-emerald-500 font-semibold">í™•ì¸</button>
    </div>
  </div>
</div>

<div id="confirmModal" class="hidden fixed inset-0 flex items-center justify-center backdrop">
  <div class="bg-slate-900 rounded-xl p-6 max-w-md w-full border border-slate-700">
    <h3 class="text-lg font-bold mb-2">ìŠ¤í•€ í™•ì¸</h3>
    <p id="confirmText" class="text-slate-300">í˜„ì¬ ê°€ì§„ ê¸ˆì•¡ â‚©100,000ìœ¼ë¡œ ë£°ë ›ì„ ëŒë¦¬ì‹œê² ìŠµë‹ˆê¹Œ?</p>
    <div class="mt-4 flex justify-end gap-2">
      <button id="confirmCancel" class="px-4 py-2 rounded-lg bg-slate-700">ì·¨ì†Œ</button>
      <button id="confirmOk" class="px-4 py-2 rounded-lg bg-rose-500 font-semibold">í™•ì¸</button>
    </div>
  </div>
</div>

<div id="resultModal" class="hidden fixed inset-0 flex items-center justify-center backdrop">
  <div class="bg-slate-900 rounded-xl p-6 max-w-md w-full border border-slate-700">
    <div id="resultTitle" class="text-xl font-bold mb-2">ê²°ê³¼</div>
    <div id="resultText" class="text-slate-200"></div>
    <div class="mt-4 flex justify-end gap-2">
      <button id="resultCancel" class="px-4 py-2 rounded-lg bg-slate-700">ì·¨ì†Œ</button>
      <button id="resultContinue" class="px-4 py-2 rounded-lg bg-emerald-500 font-semibold">ê³„ì†</button>
    </div>
  </div>
</div>

<div id="brokeModal" class="hidden fixed inset-0 flex items-center justify-center backdrop">
  <div class="bg-slate-900 rounded-xl p-6 max-w-md w-full border border-slate-700 text-center">
    <h2 class="text-2xl font-bold mb-2 text-red-400">íŒŒì‚°!</h2>
    <p class="mb-4">ë„ë°•ì€ ìœ„í—˜í•©ë‹ˆë‹¤.</p>
    <button id="brokeOk" class="px-4 py-2 rounded-lg bg-rose-500 font-semibold">í™•ì¸ (ìƒˆ ì„¸ì…˜ ì‹œì‘)</button>
  </div>
</div>

<script>
const SYMBOLS = ['â¤','â˜…','@','7','5','3','9','1','â‚©'];
let nickname='', balance=100000, spinCount=0;
let scriptedSequence=['JACKPOT','LOSS','SMALL','JACKPOT'];
let consecutiveSmall=0, consecutiveLoss=0;

const nicknameModal=document.getElementById('nicknameModal');
const nicknameInput=document.getElementById('nicknameInput');
const nickConfirm=document.getElementById('nickConfirm');
const nicknameText=document.getElementById('nicknameText');
const balanceDisplay=document.getElementById('balanceDisplay');
const spinBtn=document.getElementById('spinBtn');
const confirmModal=document.getElementById('confirmModal');
const confirmText=document.getElementById('confirmText');
const confirmOk=document.getElementById('confirmOk');
const confirmCancel=document.getElementById('confirmCancel');
const resultModal=document.getElementById('resultModal');
const resultTitle=document.getElementById('resultTitle');
const resultText=document.getElementById('resultText');
const resultCancel=document.getElementById('resultCancel');
const resultContinue=document.getElementById('resultContinue');
const brokeModal=document.getElementById('brokeModal');
const brokeOk=document.getElementById('brokeOk');
const strips=[document.getElementById('strip1'),document.getElementById('strip2'),document.getElementById('strip3')];
const logBox=document.getElementById('logBox');
const mainGame=document.getElementById('mainGame');

function formatKRW(n){return 'â‚©'+Number(Math.round(n)).toLocaleString('ko-KR');}
function log(s){const t=new Date().toLocaleTimeString('ko-KR',{hour12:false});logBox.insertAdjacentHTML('afterbegin',`<div class="text-xs text-slate-400">[${t}] ${s}</div>`);}
function showModal(el){el.classList.remove('hidden');}
function hideModal(el){el.classList.add('hidden');}

nickConfirm.addEventListener('click',()=>{
  nickname=nicknameInput.value.trim()||'ìµëª…';
  nicknameText.textContent=nickname;
  nicknameModal.classList.add('hidden');
  mainGame.classList.remove('hidden');
  log(`í™˜ì˜í•©ë‹ˆë‹¤, ${nickname}ë‹˜. ì´ˆê¸° ê¸ˆì•¡ ${formatKRW(balance)}ë¡œ ì‹œì‘í•©ë‹ˆë‹¤.`);
});

spinBtn.addEventListener('click',()=>{
  confirmText.textContent=`í˜„ì¬ ê°€ì§„ ê¸ˆì•¡ ${formatKRW(balance)}ìœ¼ë¡œ ë£°ë ›ì„ ëŒë¦¬ì‹œê² ìŠµë‹ˆê¹Œ?`;
  showModal(confirmModal);
});
confirmCancel.addEventListener('click',()=>hideModal(confirmModal));
confirmOk.addEventListener('click',()=>{hideModal(confirmModal);performSpin();});
resultCancel.addEventListener('click',()=>{hideModal(resultModal);});
resultContinue.addEventListener('click',()=>{hideModal(resultModal);showModal(confirmModal);});
brokeOk.addEventListener('click',()=>location.reload());

// ğŸï¸ ê°œì„ ëœ ë£°ë › ì• ë‹ˆë©”ì´ì…˜
function animateReels(symbols){
  return new Promise(resolve=>{
    strips.forEach((strip,i)=>{
      let count=0;
      let speed=50; // ë¹ ë¥´ê²Œ ì‹œì‘
      const spinInterval=setInterval(()=>{
        strip.textContent=SYMBOLS[Math.floor(Math.random()*SYMBOLS.length)];
        count++;
        if(count>20) speed+=40; // ì ì  ëŠë ¤ì§
        if(count>35){
          clearInterval(spinInterval);
          strip.textContent=symbols[i];
          if(i===2) setTimeout(resolve,1000); // 1ì´ˆ í›„ ê²°ê³¼ í‘œì‹œ
        }
      },speed);
    });
  });
}

function chooseReelSymbolsForOutcome(o){
  if(o==='JACKPOT'){const s=SYMBOLS[Math.floor(Math.random()*SYMBOLS.length)];return [s,s,s];}
  if(o==='SMALL'){const s1=SYMBOLS[Math.floor(Math.random()*SYMBOLS.length)],s2=s1,s3=SYMBOLS.find(x=>x!==s1);return [s1,s2,s3];}
  const arr=[...SYMBOLS].sort(()=>Math.random()-0.5);return arr.slice(0,3);
}
function getProbOutcome(){
  let r=Math.random();
  if(r<0.3 && consecutiveSmall<2){return 'SMALL';}
  if(consecutiveLoss>=3){return 'SMALL';}
  return 'LOSS';
}

async function performSpin(){
  const stake=balance;
  log(`ìŠ¤í•€ ì‹œì‘: ìŠ¤í…Œì´í¬ ${formatKRW(stake)}`);
  const outcome=(spinCount<scriptedSequence.length)?scriptedSequence[spinCount]:getProbOutcome();
  const symbols=chooseReelSymbolsForOutcome(outcome);
  await animateReels(symbols);

  let newBal=balance,winAmt=0;
  if(outcome==='JACKPOT'){newBal=stake*3;winAmt=newBal-stake;consecutiveSmall=0;consecutiveLoss=0;}
  else if(outcome==='SMALL'){newBal=Math.round(stake*1.1);winAmt=newBal-stake;consecutiveSmall++;consecutiveLoss=0;}
  else{newBal=Math.round(stake*0.5);winAmt=newBal-stake;consecutiveLoss++;consecutiveSmall=0;}
  balance=newBal;balanceDisplay.textContent=formatKRW(balance);spinCount++;

  if(outcome==='JACKPOT'){
    resultTitle.textContent='ì­íŒŸ!';
    resultText.innerHTML=`ì„¸ ì¹¸ ë‹¤ ì¼ì¹˜!<br>í˜„ì¬ ì”ì•¡: <strong>${formatKRW(newBal)}</strong>`;
  }else if(outcome==='SMALL'){
    resultTitle.textContent='ì†Œì•¡ ìŠ¹ë¦¬';
    resultText.innerHTML=`ë‘ ì¹¸ì´ ì¼ì¹˜í–ˆìŠµë‹ˆë‹¤.<br>í˜„ì¬ ì”ì•¡: <strong>${formatKRW(newBal)}</strong>`;
  }else{
    resultTitle.textContent='ì‹¤íŒ¨';
    resultText.innerHTML=`ê¸ˆì•¡ì˜ 50%ë¥¼ ìƒì—ˆìŠµë‹ˆë‹¤.<br>í˜„ì¬ ì”ì•¡: <strong>${formatKRW(newBal)}</strong>`;
  }

  showModal(resultModal);

  if(balance<50000){
    hideModal(resultModal);
    showModal(brokeModal);
    log('íŒŒì‚° ë°œìƒ: ê²Œì„ ì¢…ë£Œ');
  }
}
</script>
</body>
</html>
